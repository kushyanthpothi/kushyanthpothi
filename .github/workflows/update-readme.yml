name: ðŸ§  Update README with Repos

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:      # Manual trigger from GitHub UI

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Fetch repositories and generate markdown table
        run: |
          echo '| ðŸ§° Repo | ðŸ“„ Description | ðŸ›  Language | â­ Stars | ðŸ•’ Last Updated |' > repo_list.md
          echo '|--------|----------------|-------------|---------|-----------------|' >> repo_list.md

          curl -s https://api.github.com/users/kushyanthpothi/repos?per_page=100 | \
          jq -r '
            .[] |
            select(.archived == false) |
            "| [\(.name)](\(.html_url)) | \(.description // "No description") | \(.language // "N/A") | â­ \(.stargazers_count) | \(.updated_at | sub("T.*";"") | fromdate | strftime("%B %d, %Y")) |"
          ' >> repo_list.md

          awk '/<!--START_SECTION:repo_list-->/ {
            print; 
            while (getline < "repo_list.md") print;
            found=1; next
          }
          /<!--END_SECTION:repo_list-->/ {found=0}
          !found' README.md > temp.md && mv temp.md README.md

      - name: Commit & Push if changes found
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

          git add README.md
          git diff --cached --quiet || git commit -m "ðŸ”„ Update repo list in README"
          git push
